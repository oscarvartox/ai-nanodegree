<html><head><title>AI Nanodegree: Functions</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Intersys Consulting" /><meta name="description" content="AI Nanodegree" /><meta name="og:image" content="/ai-nanodegree/img/poster.png" /><meta name="og:title" content="AI Nanodegree: Functions" /><meta name="og:site_name" content="AI Nanodegree" /><meta name="og:url" content="https://oscarvartox.github.io/ai-nanodegree" /><meta name="og:type" content="website" /><meta name="og:description" content="AI Nanodegree" /><link rel="icon" type="image/png" href="/ai-nanodegree/img/favicon.png" /><meta name="twitter:title" content="AI Nanodegree: Functions" /><meta name="twitter:image" content="https://oscarvartox.github.io/ai-nanodegreeimg/poster.png" /><meta name="twitter:description" content="AI Nanodegree" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/ai-nanodegree/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/ai-nanodegree/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/ai-nanodegree/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/ai-nanodegree/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/ai-nanodegree/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/ai-nanodegree/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/ai-nanodegree/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/ai-nanodegree/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/ai-nanodegree/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/ai-nanodegree/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/ai-nanodegree/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/ai-nanodegree/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/ai-nanodegree/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/ai-nanodegree/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/ai-nanodegree/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/ai-nanodegree/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/ai-nanodegree/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/ai-nanodegree/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/ai-nanodegree/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/ai-nanodegree/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/ai-nanodegree/highlight/styles/default.css" /><link rel="stylesheet" href="/ai-nanodegree/css/style.css" /><link rel="stylesheet" href="/ai-nanodegree/css/palette.css" /><link rel="stylesheet" href="/ai-nanodegree/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/ai-nanodegree/" class="brand"><div class="brand-wrapper"><span>AI Nanodegree</span></div></a></li> <li><a href="/ai-nanodegree/docs.html" class="">Welcome!</a></li> <li><a href="/ai-nanodegree/docs/module1.html" class="">M1 - Introduction</a></li> </ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/oscarvartox/ai-nanodegree"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/oscarvartox/ai-nanodegree"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('AI Nanodegree AI Nanodegree');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('AI Nanodegree AI Nanodegree');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="oscarvartox" data-github-repo="ai-nanodegree"><div class="content-wrapper"><section><h1 id="module-4-example-contents">Module 4: Example Contents</h1>

<p><strong>Note</strong>: <a href="https://www.scala-lang.org/files/archive/spec/2.12/">Scala Language Specification</a>
can be used as an authoritative reference in case of doubts.</p>

<h2 id="function-types">Function types</h2>

<p>The following is an example of a simple function:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">triple</span> <span class="k">=</span> <span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<p>The <em>type</em> of this function literal is: <code class="highlighter-rouge">Int =&gt; Int</code>. We could have used
the <em>type annotation</em> to define triple:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">triple</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="nc">Int</span> <span class="k">=</span> <span class="n">n</span> <span class="k">=&gt;</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<p>That can be read like:</p>

<blockquote>
  <p><code class="highlighter-rouge">triple</code> is a function that accepts an <code class="highlighter-rouge">Int</code> parameter and returns an
<code class="highlighter-rouge">Int</code></p>
</blockquote>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">fac</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">r</span> <span class="k">=</span> <span class="mi">1</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">n</span><span class="o">)</span>
    <span class="n">r</span> <span class="k">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">i</span>
  <span class="n">r</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="compose"><code class="highlighter-rouge">compose</code></h2>

<p>It has the following signature</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">compose</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">g</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">T1</span><span class="o">)</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">R</span>
</code></pre></div></div>

<p>It models the mathematical function composition. For example, if
$f(x) = x + 1$ and $g(x) = 2x$,</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
(f \cdot g)(x) &= f(g(x)) = 2x + 1 \\
(g \cdot f)(x) &= g(f(x)) = 2(x + 1)
\end{align} %]]></script>

<h2 id="currying">Currying</h2>

<p>Letâ€™s take a look at <code class="highlighter-rouge">Functions2</code> trait scaladoc. It is used for
functions that accept <em>two</em> arguments. For example:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">add1</span><span class="k">:</span> <span class="o">(</span><span class="kt">Int</span><span class="o">,</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Int</span> <span class="k">=</span> <span class="k">_</span> <span class="o">+</span> <span class="k">_</span>
<span class="n">add1</span><span class="k">:</span> <span class="o">(</span><span class="kt">Int</span><span class="o">,</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Int</span> <span class="k">=</span> <span class="nc">$$Lambda$4280</span><span class="o">/</span><span class="mh">0x000000084153a040</span><span class="k">@</span><span class="mi">54</span><span class="n">edfb75</span>
</code></pre></div></div>

<p>A <em>curried</em> version of the above is:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">add2</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="nc">Int</span> <span class="k">=&gt;</span> <span class="nc">Int</span> <span class="k">=</span> <span class="n">a</span> <span class="k">=&gt;</span> <span class="n">b</span> <span class="k">=&gt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="n">add2</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="nc">Int</span> <span class="k">=&gt;</span> <span class="nc">Int</span><span class="o">)</span> <span class="k">=</span> <span class="nc">$$Lambda$4333</span><span class="o">/</span><span class="mh">0x000000084155d040</span><span class="k">@</span><span class="mf">3874f</span><span class="n">fe3</span>
</code></pre></div></div>

<h2 id="using-python">Using Python</h2>

<p>An example from <a href="https://www.tensorflow.org/tutorials/">https://www.tensorflow.org/tutorials/</a>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="n">mnist</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">mnist</span>

<span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span> <span class="o">=</span> <span class="n">x_train</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">,</span> <span class="n">x_test</span> <span class="o">/</span> <span class="mf">255.0</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">)</span>
<span class="p">])</span>
<span class="n">model</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s">'adam'</span><span class="p">,</span>
              <span class="n">loss</span><span class="o">=</span><span class="s">'sparse_categorical_crossentropy'</span><span class="p">,</span>
              <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">'accuracy'</span><span class="p">])</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="using-javascript">Using JavaScript</h2>

<p>From <a href="https://github.com/tensorflow/tfjs">https://github.com/tensorflow/tfjs</a>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">tf</span> <span class="k">from</span> <span class="s1">'@tensorflow/tfjs'</span><span class="p">;</span>

<span class="c1">// Define a model for linear regression.</span>
<span class="kd">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">tf</span><span class="p">.</span><span class="nx">sequential</span><span class="p">();</span>
<span class="nx">model</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">tf</span><span class="p">.</span><span class="nx">layers</span><span class="p">.</span><span class="nx">dense</span><span class="p">({</span><span class="na">units</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">inputShape</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]}));</span>

<span class="c1">// Prepare the model for training: Specify the loss and the optimizer.</span>
<span class="nx">model</span><span class="p">.</span><span class="nx">compile</span><span class="p">({</span><span class="na">loss</span><span class="p">:</span> <span class="s1">'meanSquaredError'</span><span class="p">,</span> <span class="na">optimizer</span><span class="p">:</span> <span class="s1">'sgd'</span><span class="p">});</span>

<span class="c1">// Generate some synthetic data for training.</span>
<span class="kd">const</span> <span class="nx">xs</span> <span class="o">=</span> <span class="nx">tf</span><span class="p">.</span><span class="nx">tensor2d</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>
<span class="kd">const</span> <span class="nx">ys</span> <span class="o">=</span> <span class="nx">tf</span><span class="p">.</span><span class="nx">tensor2d</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>

<span class="c1">// Train the model using the data.</span>
<span class="nx">model</span><span class="p">.</span><span class="nx">fit</span><span class="p">(</span><span class="nx">xs</span><span class="p">,</span> <span class="nx">ys</span><span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Use the model to do inference on a data point the model hasn't seen before:</span>
  <span class="nx">model</span><span class="p">.</span><span class="nx">predict</span><span class="p">(</span><span class="nx">tf</span><span class="p">.</span><span class="nx">tensor2d</span><span class="p">([</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])).</span><span class="nx">print</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="using-java">Using Java</h2>

<p>From <a href="https://raw.githubusercontent.com/tensorflow/models/master/samples/languages/java/training/src/main/java/Train.java">Train.java</a>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* Copyright 2018 The TensorFlow Authors. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
==============================================================================*/</span>

<span class="kn">import</span> <span class="nn">java.nio.file.Files</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.file.Paths</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.tensorflow.Graph</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.tensorflow.Session</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.tensorflow.Tensor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.tensorflow.Tensors</span><span class="o">;</span>

<span class="cm">/**
 * Training a trivial linear model.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Train</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Require two arguments: The GraphDef file and checkpoint directory"</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">final</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">graphDef</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">(</span><span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]));</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">checkpointDir</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
    <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">checkpointExists</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">exists</span><span class="o">(</span><span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">checkpointDir</span><span class="o">));</span>

    <span class="k">try</span> <span class="o">(</span><span class="n">Graph</span> <span class="n">graph</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Graph</span><span class="o">();</span>
        <span class="n">Session</span> <span class="n">sess</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Session</span><span class="o">(</span><span class="n">graph</span><span class="o">);</span>
        <span class="n">Tensor</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">checkpointPrefix</span> <span class="o">=</span>
            <span class="n">Tensors</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">checkpointDir</span><span class="o">,</span> <span class="s">"ckpt"</span><span class="o">).</span><span class="na">toString</span><span class="o">()))</span> <span class="o">{</span>
      <span class="n">graph</span><span class="o">.</span><span class="na">importGraphDef</span><span class="o">(</span><span class="n">graphDef</span><span class="o">);</span>

      <span class="c1">// Initialize or restore.</span>
      <span class="c1">// The names of the tensors in the graph are printed out by the program</span>
      <span class="c1">// that created the graph:</span>
      <span class="c1">// https://github.com/tensorflow/models/blob/master/samples/languages/java/training/model/create_graph.py</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">checkpointExists</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sess</span><span class="o">.</span><span class="na">runner</span><span class="o">().</span><span class="na">feed</span><span class="o">(</span><span class="s">"save/Const"</span><span class="o">,</span> <span class="n">checkpointPrefix</span><span class="o">).</span><span class="na">addTarget</span><span class="o">(</span><span class="s">"save/restore_all"</span><span class="o">).</span><span class="na">run</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">sess</span><span class="o">.</span><span class="na">runner</span><span class="o">().</span><span class="na">addTarget</span><span class="o">(</span><span class="s">"init"</span><span class="o">).</span><span class="na">run</span><span class="o">();</span>
      <span class="o">}</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Starting from       : "</span><span class="o">);</span>
      <span class="n">printVariables</span><span class="o">(</span><span class="n">sess</span><span class="o">);</span>

      <span class="c1">// Train a bunch of times.</span>
      <span class="c1">// (Will be much more efficient if we sent batches instead of individual values).</span>
      <span class="kd">final</span> <span class="n">Random</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
      <span class="kd">final</span> <span class="kt">int</span> <span class="n">NUM_EXAMPLES</span> <span class="o">=</span> <span class="mi">500</span><span class="o">;</span>
      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">NUM_EXAMPLES</span><span class="o">;</span> <span class="n">n</span><span class="o">++)</span> <span class="o">{</span>
          <span class="kt">float</span> <span class="n">in</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="na">nextFloat</span><span class="o">();</span>
          <span class="k">try</span> <span class="o">(</span><span class="n">Tensor</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span> <span class="n">input</span> <span class="o">=</span> <span class="n">Tensors</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">in</span><span class="o">);</span>
              <span class="n">Tensor</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span> <span class="n">target</span> <span class="o">=</span> <span class="n">Tensors</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">in</span> <span class="o">+</span> <span class="mi">2</span><span class="o">))</span> <span class="o">{</span>
            <span class="c1">// Again the tensor names are from the program that created the graph.</span>
            <span class="c1">// https://github.com/tensorflow/models/blob/master/samples/languages/java/training/model/create_graph.py</span>
            <span class="n">sess</span><span class="o">.</span><span class="na">runner</span><span class="o">().</span><span class="na">feed</span><span class="o">(</span><span class="s">"input"</span><span class="o">,</span> <span class="n">input</span><span class="o">).</span><span class="na">feed</span><span class="o">(</span><span class="s">"target"</span><span class="o">,</span> <span class="n">target</span><span class="o">).</span><span class="na">addTarget</span><span class="o">(</span><span class="s">"train"</span><span class="o">).</span><span class="na">run</span><span class="o">();</span>
          <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"After %5d examples: "</span><span class="o">,</span> <span class="n">i</span><span class="o">*</span><span class="n">NUM_EXAMPLES</span><span class="o">);</span>
        <span class="n">printVariables</span><span class="o">(</span><span class="n">sess</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="c1">// Checkpoint.</span>
      <span class="c1">// The feed and target name are from the program that created the graph.</span>
      <span class="c1">// https://github.com/tensorflow/models/blob/master/samples/languages/java/training/model/create_graph.py.</span>
      <span class="n">sess</span><span class="o">.</span><span class="na">runner</span><span class="o">().</span><span class="na">feed</span><span class="o">(</span><span class="s">"save/Const"</span><span class="o">,</span> <span class="n">checkpointPrefix</span><span class="o">).</span><span class="na">addTarget</span><span class="o">(</span><span class="s">"save/control_dependency"</span><span class="o">).</span><span class="na">run</span><span class="o">();</span>

      <span class="c1">// Example of "inference" in the same graph:</span>
      <span class="k">try</span> <span class="o">(</span><span class="n">Tensor</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span> <span class="n">input</span> <span class="o">=</span> <span class="n">Tensors</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">1.0f</span><span class="o">);</span>
          <span class="n">Tensor</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span> <span class="n">output</span> <span class="o">=</span>
              <span class="n">sess</span><span class="o">.</span><span class="na">runner</span><span class="o">().</span><span class="na">feed</span><span class="o">(</span><span class="s">"input"</span><span class="o">,</span> <span class="n">input</span><span class="o">).</span><span class="na">fetch</span><span class="o">(</span><span class="s">"output"</span><span class="o">).</span><span class="na">run</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">expect</span><span class="o">(</span><span class="n">Float</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span>
            <span class="s">"For input %f, produced %f (ideally would produce 3*%f + 2)\n"</span><span class="o">,</span>
            <span class="n">input</span><span class="o">.</span><span class="na">floatValue</span><span class="o">(),</span> <span class="n">output</span><span class="o">.</span><span class="na">floatValue</span><span class="o">(),</span> <span class="n">input</span><span class="o">.</span><span class="na">floatValue</span><span class="o">());</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">printVariables</span><span class="o">(</span><span class="n">Session</span> <span class="n">sess</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Tensor</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">values</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="na">runner</span><span class="o">().</span><span class="na">fetch</span><span class="o">(</span><span class="s">"W/read"</span><span class="o">).</span><span class="na">fetch</span><span class="o">(</span><span class="s">"b/read"</span><span class="o">).</span><span class="na">run</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"W = %f\tb = %f\n"</span><span class="o">,</span> <span class="n">values</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">floatValue</span><span class="o">(),</span> <span class="n">values</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">floatValue</span><span class="o">());</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Tensor</span><span class="o">&lt;?&gt;</span> <span class="n">t</span> <span class="o">:</span> <span class="n">values</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">t</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/ai-nanodegree/highlight/highlight.pack.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/fsharp.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/csharp.min.js"></script><script>hljs.configure({languages:['scala','java','bash','haskell','fsharp','scala','python','java','csharp']});
hljs.initHighlighting();
              </script><script src="/ai-nanodegree/js/mathjax-config.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML,https://oscarvarto.github.io/learning-scala/js/mathjax-config.js"></script><script>((window.gitter = {}).chat = {}).options = {
room: 'IntersysConsulting/ai-nanodegree'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/ai-nanodegree/js/main.js"></script></body></html>